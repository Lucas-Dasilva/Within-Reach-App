(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"99Un":function(t,n,i){"use strict";i.r(n),i.d(n,"HomePageModule",(function(){return I}));var o=i("ofXK"),e=i("3Pt+"),s=i("TEn/"),r=i("tyNb"),a=i("mrSG"),c=i("4WUr"),b=i("2Vo4"),l=i("eIep"),u=i("XNiG"),d=i("fXoL"),h=i("yHma"),p=i("EQNs"),f=i("2ZZ0"),m=i("qfBg"),g=i("/Hhz"),y=i("Wu1i");const x=["karmaCard"];function C(t,n){if(1&t){const t=d.Lb();d.Kb(0,"ion-chip",14),d.Sb("click",(function(){return d.dc(t),d.Ub().karmaChipAnimation()})),d.Kb(1,"ion-label"),d.jc(2),d.Jb(),d.Jb()}if(2&t){const t=n.ngIf;d.xb(2),d.kc(t.karma)}}function k(t,n){if(1&t){const t=d.Lb();d.Kb(0,"ion-col",24),d.Sb("click",(function(){d.dc(t);const n=d.Ub().$implicit;return d.Ub(2).gotToComments(n.id)})),d.Ib(1,"ion-icon",25),d.Kb(2,"div",23),d.jc(3,"none"),d.Jb(),d.Jb()}}function _(t,n){if(1&t){const t=d.Lb();d.Kb(0,"ion-col",24),d.Sb("click",(function(){d.dc(t);const n=d.Ub().$implicit;return d.Ub(2).gotToComments(n.id)})),d.Ib(1,"ion-icon",25),d.Kb(2,"div",23),d.jc(3,"1 reply"),d.Jb(),d.Jb()}}function J(t,n){if(1&t){const t=d.Lb();d.Kb(0,"ion-col",24),d.Sb("click",(function(){d.dc(t);const n=d.Ub().$implicit;return d.Ub(2).gotToComments(n.id)})),d.Ib(1,"ion-icon",26),d.Kb(2,"div",23),d.jc(3),d.Jb(),d.Jb()}if(2&t){const t=d.Ub().$implicit;d.xb(3),d.lc("",t.reply_count," replies")}}function K(t,n){if(1&t){const t=d.Lb();d.Kb(0,"ion-card"),d.Kb(1,"ion-row"),d.Kb(2,"ion-col",16),d.Sb("click",(function(){d.dc(t);const i=n.$implicit;return d.Ub(2).gotToComments(i.id)})),d.jc(3),d.Jb(),d.Kb(4,"ion-col",17),d.Ib(5,"app-vote-button",18),d.Jb(),d.Jb(),d.Kb(6,"ion-footer",1),d.Kb(7,"ion-grid"),d.Kb(8,"ion-row"),d.Kb(9,"ion-col",19),d.Ib(10,"ion-icon",20),d.jc(11),d.Vb(12,"datepipe"),d.Jb(),d.hc(13,k,4,0,"ion-col",21),d.hc(14,_,4,0,"ion-col",21),d.hc(15,J,4,1,"ion-col",21),d.Kb(16,"ion-col",22),d.Kb(17,"div",23),d.jc(18),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Jb()}if(2&t){const t=n.$implicit,i=d.Ub().ngIf;d.xb(3),d.lc(" ",t.body," "),d.xb(2),d.Zb("reactions",i.react_list)("post_id",t.id)("post_user",t.user_id)("likes",t.likes),d.xb(6),d.lc(" ",d.Wb(12,10,t.timestamp)," "),d.xb(2),d.Zb("ngIf",0==t.reply_count),d.xb(1),d.Zb("ngIf",1==t.reply_count),d.xb(1),d.Zb("ngIf",t.reply_count>1),d.xb(3),d.lc(" ",t.distance," miles")}}function P(t,n){if(1&t&&(d.Kb(0,"ion-list",1),d.hc(1,K,19,12,"ion-card",15),d.Jb()),2&t){const t=n.ngIf;d.xb(1),d.Zb("ngForOf",t.post_list)}}const O=[{path:"",component:(()=>{class t{constructor(t,n,i,o,e,s,r,a){this.location=t,this.animationCtrl=n,this.getData=i,this.modalCtrl=o,this.postData=e,this.nav=s,this.router=r,this.user=a,this.stopPolling=new u.a,this.refresh$=new b.a(!0)}ngOnInit(){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.user.userInfo(),yield this.location.getCoords(),this.user_id=this.user.uuid}catch(t){this.user&&this.nav.navigateRoot("error")}this.card=this.karmaCard.el,this.setupFlipAnimation()}))}ionViewWillEnter(){this.userLat=this.location.currentLocation.latitude,this.userLon=this.location.currentLocation.longitude,this.user$=this.refresh$.pipe(Object(l.a)(t=>this.getData.getUser(this.user.uuid))),this.posts$=this.refresh$.pipe(Object(l.a)(t=>this.getData.getPosts(this.userLat,this.userLon,this.user.uuid)))}doRefresh(t){return Object(a.a)(this,void 0,void 0,(function*(){setTimeout(()=>{this.refresh$.next(!0),t.target.complete()},250)}))}sortPosts(t){"hot"==t.target.value?this.posts$=this.refresh$.pipe(Object(l.a)(t=>this.getData.getPostsSorted(this.userLat,this.userLon,this.user_id))):"new"==t.target.value&&(this.posts$=this.refresh$.pipe(Object(l.a)(t=>this.getData.getPosts(this.userLat,this.userLon,this.user_id))))}createPost(){return Object(a.a)(this,void 0,void 0,(function*(){let t=yield this.modalCtrl.create({component:c.a});yield t.present(),t.onDidDismiss().then(t=>{null!=t.data&&(this.userLat=this.location.currentLocation.latitude,this.userLon=this.location.currentLocation.longitude,this.postData.createPostRequest(this.userLat,this.userLon,this.user_id,t.data.postBod).then(()=>{this.refresh$.next(!0)}))})}))}gotToComments(t){let n={queryParams:{post_id:JSON.stringify(t)}};this.router.navigate(["comments"],n)}ngOnDestroy(){this.stopPolling.next()}setupFlipAnimation(){const t=this.animationCtrl.create("flip").addElement(this.card).duration(300).keyframes([{offset:0,transform:"rotateX(0)",opacity:0},{offset:1,transform:"rotateX(-180deg)",opacity:1}]),n=this.animationCtrl.create("slide").addElement(this.card).duration(300).keyframes([{offset:0,transform:"translateY(-800px) translateX(-1000px)",opacity:0},{offset:1,transform:"translateY(0) translateX(0)",opacity:1}]);this.flipAnimation=this.animationCtrl.create("flip-animation").duration(400).easing("ease-out").addAnimation([t,n])}karmaChipAnimation(){this.flipAnimation.play()}}return t.\u0275fac=function(n){return new(n||t)(d.Hb(h.a),d.Hb(s.b),d.Hb(p.a),d.Hb(s.F),d.Hb(f.a),d.Hb(s.G),d.Hb(r.g),d.Hb(m.a))},t.\u0275cmp=d.Bb({type:t,selectors:[["app-home"]],viewQuery:function(t,n){var i;1&t&&d.mc(x,!0),2&t&&d.bc(i=d.Tb())&&(n.karmaCard=i.first)},decls:21,vars:7,consts:[[3,"translucent"],["mode","ios"],["lines","none","slot","start",3,"click",4,"ngIf"],["mode","ios","value","new",3,"ionChange"],["value","new"],["value","hot"],["slot","end"],[3,"click"],["name","create-outline"],["id","karmaCard"],["karmaCard",""],["slot","fixed",3,"ionRefresh"],["pullingIcon","circular"],["mode","ios",4,"ngIf"],["lines","none","slot","start",3,"click"],[4,"ngFor","ngForOf"],["size","10",1,"body",3,"click"],["size","2",1,"vote"],[3,"reactions","post_id","post_user","likes"],["size","4",1,"time"],["name","time-outline"],["size","4","class","reply",3,"click",4,"ngIf"],["size","4",1,"distance"],[1,"text"],["size","4",1,"reply",3,"click"],["name","chatbubble-outline"],["name","chatbubbles-outline"]],template:function(t,n){1&t&&(d.Kb(0,"ion-header",0),d.Kb(1,"ion-toolbar",1),d.hc(2,C,3,1,"ion-chip",2),d.Vb(3,"async"),d.Kb(4,"ion-segment",3),d.Sb("ionChange",(function(t){return n.sortPosts(t)})),d.Kb(5,"ion-segment-button",4),d.Kb(6,"ion-label"),d.jc(7,"New"),d.Jb(),d.Jb(),d.Kb(8,"ion-segment-button",5),d.Kb(9,"ion-label"),d.jc(10,"Hot"),d.Jb(),d.Jb(),d.Jb(),d.Kb(11,"ion-buttons",6),d.Kb(12,"ion-button",7),d.Sb("click",(function(){return n.createPost()})),d.Ib(13,"ion-icon",8),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Kb(14,"ion-content"),d.Ib(15,"ion-card",9,10),d.Kb(17,"ion-refresher",11),d.Sb("ionRefresh",(function(t){return n.doRefresh(t)})),d.Ib(18,"ion-refresher-content",12),d.Jb(),d.hc(19,P,2,1,"ion-list",13),d.Vb(20,"async"),d.Jb()),2&t&&(d.Zb("translucent",!0),d.xb(2),d.Zb("ngIf",d.Wb(3,3,n.user$)),d.xb(17),d.Zb("ngIf",d.Wb(20,5,n.posts$)))},directives:[s.n,s.B,o.k,s.x,s.I,s.y,s.r,s.g,s.f,s.o,s.k,s.h,s.t,s.u,s.i,s.s,o.j,s.w,s.j,g.a,s.l,s.m],pipes:[o.b,y.a],styles:["ion-footer[_ngcontent-%COMP%]{display:inline;margin:auto}ion-chip[_ngcontent-%COMP%], ion-refresher[_ngcontent-%COMP%]{--color:#5600f7}ion-chip[_ngcontent-%COMP%]{--background:#fff}ion-label[_ngcontent-%COMP%]{font-weight:700}ion-button[_ngcontent-%COMP%]{--color:#5600f7}ion-icon[_ngcontent-%COMP%]{vertical-align:middle;padding-bottom:3.5px}#karmaCard[_ngcontent-%COMP%]{display:none;width:100px;height:100px;background:rgba(0,0,255,.5);margin:10px}.time[_ngcontent-%COMP%]{padding-left:4px}.distance[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{font-size:13px;padding-top:1em;color:#7972da}.distance[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin:auto;padding-right:4px}.vote[_ngcontent-%COMP%]{display:flex;padding-bottom:0;align-items:center}.reply[_ngcontent-%COMP%]{font-size:13px;justify-content:center;padding-top:1em;display:flex}.text[_ngcontent-%COMP%]{margin-left:.5em}.body[_ngcontent-%COMP%]{padding:1em}@media (prefers-color-scheme:light){ion-card[_ngcontent-%COMP%]{box-shadow:5px 5px 15px 5px hsla(0,0%,66.7%,.41);--color:#5f656d}}@media (prefers-color-scheme:dark){ion-card[_ngcontent-%COMP%]{box-shadow:2px 2px 17px 4px rgba(0,0,0,.41)}}"]}),t})()}];let v=(()=>{class t{}return t.\u0275mod=d.Fb({type:t}),t.\u0275inj=d.Eb({factory:function(n){return new(n||t)},imports:[[r.i.forChild(O)],r.i]}),t})();var w=i("nETc");let I=(()=>{class t{}return t.\u0275mod=d.Fb({type:t}),t.\u0275inj=d.Eb({factory:function(n){return new(n||t)},imports:[[o.c,e.a,s.C,v,w.a]]}),t})()}}]);