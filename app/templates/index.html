{% extends "base.html" %}

{% block content %}

    <img class = "homeLogo" src="{{ url_for('static', filename = 'logo3.gif' )}}" >
    <h1 class= "hometitle">Within Reach</h1>

    <!-- Get New Location upon refresh -->
    <p id="status"></p>
    <script type="text/javascript" src="static/location.js"></script>

    {% if sortform %}
        <form action ="" method = 'POST'> 
            
            <div class ="sort">     
                {{sortform.sort.label}}
                {{ sortform.sort }}
                {{ sortform.submit(class="button")}}
            </div>
        </form>
    {% endif %}

    <div class = "postlist">
        <!-- Fail safe check if local user cleared there cache, simply use the values in the userDistace Db instead -->
        {% for post in posts %}
            {% if (post.likes == topPost) %}
                <div class = "topPostTitle">
                    <h1>Top Post: </h1>
                    <div class="topPost">{% include '_post.html' %} </div>
                </div>
            {% endif%}
        {% endfor %}
        {% if "latitude" in session %}
            {% for post in posts %}
                {% if (post.id|string) in session %}
                    {% if session[(post.id|string)] < 5|float %}
                    <div class="mainPost">{% include '_post.html' %} </div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% else %}
            {% for post in posts %}
                {% if (post.user_id == current_user.id) %}
                    <div class="mainPost">{% include '_post.html' %} </div>
                {% endif%}
                {% for dist in post.distance_from_user %}
                    {% if dist.user_id == current_user.id and dist.distance < 5.0|float %}
                        <div class="mainPost">{% include '_post.html' %} </div>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        {% endif %}

    </div>
    
{% endblock %}